# åœ¨åä¸ºäº‘éƒ¨ç½²é¡¹ç›®

## Demoä»‹ç»

å¼€å‘ä»»åŠ¡ä¸­å¯¹Demoçš„è¦æ±‚å¦‚ä¸‹ï¼š

1.é€šè¿‡æœ¬åœ° GaussDB ä½œä¸ºæ•°æ®æºï¼Œé€šè¿‡ dbt-core å°†æ•°æ®è½¬æ¢æˆ GaussDB(DWS)é€‚ç”¨çš„æ•°æ®ï¼Œé€šè¿‡ GaussDB(DWS) çš„APIä¸Šä¼ æ•°æ®;

2.GaussDB(DWS) æ¥æ”¶åˆ°è½¬æ¢åçš„æ•°æ®ï¼Œåˆ©ç”¨ GaussDB(DWS) é«˜æ•ˆçš„æ•°æ®åŠ è½½ã€è½¬æ¢å’ŒæŸ¥è¯¢æ€§èƒ½ç­‰ä¼˜åŠ¿ï¼Œç”Ÿæˆç›®æ ‡æ•°æ®;

3.æœ€åï¼Œé€šè¿‡RESTful APIæ“ä½œæ•°æ®åº“ä¾›å‰ç«¯ä½¿ç”¨ã€‚

ç»è¿‡åˆ†æï¼Œé‡‡ç”¨Jaffle Shopæ¥å®ç°Demoã€‚

### Demoä¸šåŠ¡åœºæ™¯ä»‹ç»

Jaffle Shop å‡è®¾äº†ä¸€å®¶åœ¨çº¿é›¶å”®å•†çš„ä¸šåŠ¡æ¨¡å‹ï¼Œæ¨¡æ‹Ÿäº†å®¢æˆ·è´­ä¹°è¡Œä¸ºçš„æ•°æ®æµè½¬ã€‚å…¶æ•°æ®æ¥æºæ˜¯CSVæ–‡ä»¶ï¼ŒåŒ…å« è®¢å•ã€å®¢æˆ·å’Œæ”¯ä»˜ ç­‰åŸå§‹æ•°æ®ã€‚è¿™äº›æ•°æ®ç»è¿‡ dbt-gaussdbdws åŠ è½½åˆ°GaussDBï¼Œåœ¨GaussDBä¸­è¿›è¡Œåˆæ­¥è½¬æ¢åï¼Œç”Ÿæˆä¸€ç³»åˆ—å¹²å‡€ã€è§„èŒƒåŒ–çš„æ•°æ®è¡¨ã€‚å†åŒæ­¥åˆ°GaussDB(DWS),ç»è¿‡ dbt-gaussdbdws çš„æ¸…æ´—ï¼Œå¾—åˆ°ç»“æœè¡¨ï¼ˆå¦‚æ±‡æ€»è¡¨æˆ–ç»´åº¦è¡¨ï¼‰ï¼Œä¸ºåˆ†æå¸ˆæä¾›æ”¯æŒã€‚

Jaffle Shop æ˜¯ç†è§£ç°ä»£æ•°æ®å»ºæ¨¡å’Œè½¬æ¢çš„æœ€ä½³å®è·µçš„å®Œç¾èµ·ç‚¹ã€‚

### Demoéƒ¨ç½²æ¶æ„

ä¸‹å›¾æ˜¯Demoçš„éƒ¨ç½²æ¶æ„ï¼ŒåŸºäºCCEå®¹å™¨åŒ–éƒ¨ç½²ï¼š

![éƒ¨ç½²æ¶æ„](../assets/2-0.png)

- ç»ˆç«¯å±‚

æ”¯æŒä¸åŒçš„ç±»å‹ç»ˆç«¯è®¿é—®Restful APIæ¥å£

- ç½‘å…³å±‚

é€šè¿‡ELBè¿›è¡Œè´Ÿè½½å‡è¡¡ä»£ç†

- ä¸­é—´å±‚

åœ¨CCEä¸­éƒ¨ç½²3ä¸ªæ— çŠ¶æ€æœåŠ¡ï¼š

jaffle-shop-gaussdb: è´Ÿè´£åŠ è½½åŸå§‹æ•°æ®åˆ°GaussDBï¼Œå¹¶ä¸”åœ¨GaussDBä¸­åˆåŠ å·¥æ•°æ®

jaffle-shop-dws: è´Ÿè´£å¯¹GaussDB(DWS)ä¸­é—´è¡¨è¿›è¡Œæ±‡æ€»åŠ å·¥ï¼Œå¾—åˆ°ç»“æœè¡¨

resource-service-python: è´Ÿè´£å¯¹GaussDB(DWS)ç»“æœè¡¨æä¾›RESTful APIæ¥å£

- æ•°æ®åº“å±‚

GaussDBåŠ å·¥åŸå§‹ä¸šåŠ¡æ•°æ®ï¼Œä¸»è¦è´Ÿè´£åˆæ­¥æ¸…æ´—

GaussDB(DWS)åŠ å·¥æ±‡æ€»æ•°æ®ï¼Œå¾—åˆ°ç»“æœè¡¨



### Demoæ•°æ®æµå›¾

ä¸‹å›¾ä»æ•´ä½“é€»è¾‘ä¸Šä»‹ç»äº†æ¯ä¸ªè¿‡ç¨‹çš„æ•°æ®å¤„ç†ï¼š

![é€»è¾‘æ¶æ„](../assets/2-1.png)


ä¸‹å›¾ä¸»è¦ä»‹ç»åœ¨GaussDBä¸­æ¯ä¸ªè¡¨çš„åŠ å·¥é€»è¾‘ï¼š

![æ•°æ®æµå›¾](../assets/2-2.png)

ä¸‹å›¾ä¸»è¦ä»‹ç»åœ¨GaussDB(DWS)ä¸­æ¯ä¸ªè¡¨çš„åŠ å·¥é€»è¾‘ï¼š

![æ•°æ®æµå›¾](../assets/2-3.png)


### Demoå¼€æºåœ°å€

Demoä¸­æ¶‰åŠçš„å¼€æºé¡¹ç›®åœ°å€å¦‚ä¸‹ï¼š

- [jaffle-shop-gaussdb](https://github.com/pangpang20/jaffle-shop-gaussdb.git) : è´Ÿè´£åŠ è½½åŸå§‹æ•°æ®åˆ°GaussDBï¼Œå¹¶ä¸”åœ¨GaussDBä¸­åˆåŠ å·¥æ•°æ®
- [jaffle-shop-dws](https://github.com/pangpang20/jaffle-shop-dws.git) : è´Ÿè´£å¯¹GaussDB(DWS)ä¸­é—´è¡¨è¿›è¡Œæ±‡æ€»åŠ å·¥ï¼Œå¾—åˆ°ç»“æœè¡¨
- [resource-service-python](https://github.com/pangpang20/resource-service-python.git) : è´Ÿè´£å¯¹GaussDB(DWS)ç»“æœè¡¨æä¾›RESTful APIæ¥å£

## æ­¥éª¤ä¸€ï¼šäº‘èµ„æºè´­ä¹°ä¸é…ç½®

Demoéƒ¨ç½²ä¸»è¦ä¾èµ–çš„äº‘èµ„æºå¦‚ä¸‹ï¼š

- VPC: è™šæ‹Ÿç§æœ‰äº‘ï¼Œå®ç°éš”ç¦»
- ECSï¼šåˆ¶ä½œé•œåƒ
- ELBï¼šè´Ÿè½½å‡è¡¡å’Œä»£ç†
- GaussDBï¼šæ•°æ®åº“åŠ å·¥åŸå§‹æ•°æ®
- GaussDB(DWS)ï¼šæ•°æ®åº“åŠ å·¥æ±‡æ€»æ•°æ®
- CCEï¼šå®¹å™¨åŒ–éƒ¨ç½²
- SWR: å­˜æ”¾å®¹å™¨é•œåƒ
- NATç½‘å…³: å®¹å™¨ä¸­è®¿é—®å…¬ç½‘

### è´­ä¹°ECSå¹¶å…‹éš†é¡¹ç›®

ECSé…ç½®å¦‚ä¸‹ï¼š

- è´­ä¹°æ•°é‡ï¼š1å°
- è§„æ ¼ï¼šé²²é¹é€šç”¨è®¡ç®—å¢å¼ºå‹ |  kc1.2xlarge.4 | 8vCPUs | 32GiB
- é•œåƒ: Huawei Cloud EulerOS 2.0 æ ‡å‡†ç‰ˆ 64ä½ ARMç‰ˆ
- ç™»å½•å‡­è¯ï¼šå¯†ç 
- ç³»ç»Ÿç›˜: é€šç”¨å‹SSD, 40GiB

å…·ä½“è´­ä¹°æ“ä½œå¯å‚è€ƒ [å¿«é€Ÿè´­ä¹°å’Œä½¿ç”¨Linux ECS](https://support.huaweicloud.com/qs-ecs/ecs_01_0103.html)

è´­ä¹°åï¼Œå¾…æœåŠ¡å™¨å¯åŠ¨ï¼Œç™»å½•æœåŠ¡å™¨æŒ‰ä¸‹é¢çš„æ“ä½œç»§ç»­ã€‚

#### å®‰è£…Docker

å‚è€ƒ [åŸºäºEulerOSéƒ¨ç½²Docker](https://bbs.huaweicloud.com/blogs/441849)

#### å®‰è£…Git

å‚è€ƒ [åŸºäºEulerOSé…ç½®GitHub](https://bbs.huaweicloud.com/blogs/441850)

#### å…‹éš†é¡¹ç›®å¹¶ä¸”åˆ¶ä½œé•œåƒ

```bash
# åˆ›å»ºå·¥ä½œç›®å½•
mkdir mydemo
cd mydemo/

# å…‹éš† jaffle-shop-gaussdb
git clone https://github.com/pangpang20/jaffle-shop-gaussdb.git

# åˆ¶ä½œé•œåƒ jaffle-shop-gaussdb:1.0.0 (æ³¨æ„ï¼šéœ€è¦ä¸€æ®µæ—¶é—´ï¼Œæ ¹æ®å®é™…ç½‘ç»œè€Œå®š)
cd jaffle-shop-gaussdb
docker build -t jaffle-shop-gaussdb:1.0.0  .

# è¿”å›å·¥ä½œç›®å½•ï¼Œå…‹éš† jaffle-shop-dws
cd ..
git clone https://github.com/pangpang20/jaffle-shop-dws.git

# åˆ¶ä½œé•œåƒ jaffle-shop-dws:1.0.0
cd jaffle-shop-dws
docker build -t jaffle-shop-dws:1.0.0  .


# è¿”å›å·¥ä½œç›®å½•ï¼Œå…‹éš† resource-service-python
cd ..
git clone https://github.com/pangpang20/resource-service-python.git

# åˆ¶ä½œé•œåƒ resource-service-python:1.0.0
cd resource-service-python
docker build -t resource-service-python:1.0.0  .


# æŸ¥çœ‹é•œåƒ(3ä¸ªé•œåƒ)
docker images

```

#### ä¸Šä¼ é•œåƒåˆ°SWR

è¿›å…¥`å®¹å™¨é•œåƒæœåŠ¡ SWR`ï¼Œç‚¹å‡» `ç»„ç»‡ç®¡ç†` ,ç‚¹å‡» `åˆ›å»ºç»„ç»‡`

ç‚¹å‡»`æ€»è§ˆ`ï¼Œç‚¹å‡»å³ä¸Šè§’ `ç™»å½•æŒ‡ä»¤`ï¼Œå¤åˆ¶åˆ°ECSä¸­æ‰§è¡Œ

![ç™»å½•æŒ‡ä»¤](../assets/2-4.png)

ä¸Šä¼ é•œåƒ


```bash
sudo docker tag {é•œåƒåç§°}:{ç‰ˆæœ¬åç§°} swr.cn-south-1.myhuaweicloud.com/{ç»„ç»‡åç§°}/{é•œåƒåç§°}:{ç‰ˆæœ¬åç§°}

sudo docker push swr.cn-south-1.myhuaweicloud.com/{ç»„ç»‡åç§°}/{é•œåƒåç§°}:{ç‰ˆæœ¬åç§°}

```

ä¸Šä¼ ååœ¨`æˆ‘çš„é•œåƒ`ä¸­å¯ä»¥æŸ¥çœ‹

![æˆ‘çš„é•œåƒ](../assets/2-5.png)

### è´­ä¹°GaussDBå¹¶åˆ›å»ºç”¨æˆ·å’Œæ•°æ®åº“


GaussDBé…ç½®å¦‚ä¸‹ï¼š

- æ•°æ®åº“å¼•æ“: GaussDB
- æ•°æ®åº“å¼•æ“ç‰ˆæœ¬:V2.0-8.201
- å†…æ ¸å¼•æ“ç‰ˆæœ¬:505.2.0
- å®ä¾‹ç±»å‹: é›†ä¸­å¼ç‰ˆ
- éƒ¨ç½²å½¢æ€: 1ä¸»2å¤‡
- æ€§èƒ½è§„æ ¼: é€šç”¨å‹ï¼ˆ1:4ï¼‰| 4 vCPUs | 16 GB
- å­˜å‚¨ç©ºé—´: 40 GB
- æ•°æ®åº“ç«¯å£: é»˜è®¤ç«¯å£8000

å…·ä½“è´­ä¹°æ“ä½œå¯å‚è€ƒ [è´­ä¹°å¹¶é€šè¿‡ç•Œé¢åŒ–å·¥å…·DASè¿æ¥GaussDBå®ä¾‹ï¼ˆæ¨èï¼‰](https://support.huaweicloud.com/qs-gaussdb/gaussdb_01_622.html)

è´­ä¹°åï¼Œå¾…æ•°æ®åº“å®ä¾‹å¯åŠ¨ï¼Œç™»å½•DASåˆ›å»ºæ•°æ®åº“å’Œåˆ›å»ºç”¨æˆ·ã€‚

> **ğŸ”” æ³¨æ„ï¼š**
> è¿™é‡Œéœ€è¦è®°å½•EIPæˆ–å†…ç½‘IPï¼Œæ•°æ®åº“åï¼Œç”¨æˆ·åï¼Œå¯†ç ï¼Œåé¢éœ€è¦ã€‚


### è´­ä¹°GaussDB(DWS)å¹¶åˆ›å»ºç”¨æˆ·å’Œæ•°æ®åº“

GaussDB(DWS)é…ç½®å¦‚ä¸‹ï¼š

- ç‰ˆæœ¬é€‰æ‹©ï¼šå­˜ç®—ä¸€ä½“
- éƒ¨ç½²ç±»å‹: é›†ç¾¤
- èŠ‚ç‚¹æ•°é‡ï¼š3
- å­˜å‚¨å®¹é‡ï¼š20G/èŠ‚ç‚¹
- é›†ç¾¤ç‰ˆæœ¬: 9.1.0.211


å…·ä½“è´­ä¹°æ“ä½œå¯å‚è€ƒ [å¿«é€Ÿåˆ›å»ºGaussDB(DWS)é›†ç¾¤å¹¶å¯¼å…¥æ•°æ®è¿›è¡ŒæŸ¥è¯¢](https://support.huaweicloud.com/qs-dws/index.html)

è´­ä¹°åï¼Œå¾…æ•°æ®åº“å®ä¾‹å¯åŠ¨ï¼Œå¯å‚è€ƒ[åˆ›å»ºGaussDB(DWS)æ•°æ®åº“å’Œç”¨æˆ·](https://support.huaweicloud.com/mgtg-dws/dws_01_01113.html)

> **ğŸ”” æ³¨æ„ï¼š**
> è¿™é‡Œéœ€è¦è®°å½•EIPæˆ–å†…ç½‘IPï¼Œæ•°æ®åº“åï¼Œç”¨æˆ·åï¼Œå¯†ç ï¼Œåé¢éœ€è¦ã€‚


### è´­ä¹°CCEå’ŒèŠ‚ç‚¹


CCEé…ç½®å¦‚ä¸‹ï¼š

- é›†ç¾¤ç±»å‹CCE: Turbo
- å®¹å™¨ç½‘ç»œæ¨¡å‹äº‘åŸç”Ÿç½‘ç»œ: 2.0
- é›†ç¾¤ç‰ˆæœ¬: v1.30
- é›†ç¾¤è§„æ¨¡: 50 èŠ‚ç‚¹
- é›†ç¾¤ master å®ä¾‹æ•°: 3å®ä¾‹ï¼ˆé«˜å¯ç”¨ï¼‰

CCEé›†ç¾¤åˆ›å»ºåï¼Œåˆ›å»ºèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹é…ç½®å¦‚ä¸‹ï¼š

- èŠ‚ç‚¹ç±»å‹ï¼šå¼¹æ€§äº‘æœåŠ¡å™¨-è™šæ‹Ÿæœº
- èŠ‚ç‚¹è§„æ ¼ï¼šé²²é¹é€šç”¨è®¡ç®—å¢å¼ºå‹ | kc2.2xlarge.4 | 8 vCPUs | 32 GiB
- å®¹å™¨å¼•æ“ï¼šDocker
- æ“ä½œç³»ç»Ÿï¼šHuawei Cloud EulerOS2.0
- ç™»å½•æ–¹å¼ï¼šå¯†ç 
- ç£ç›˜ï¼šé»˜è®¤
- èŠ‚ç‚¹æ•°é‡ï¼š3

å…·ä½“è´­ä¹°æ“ä½œå¯å‚è€ƒ [åœ¨CCEé›†ç¾¤ä¸­éƒ¨ç½²NGINXæ— çŠ¶æ€å·¥ä½œè´Ÿè½½](https://support.huaweicloud.com/qs-cce/cce_qs_0003.html)


### è´­ä¹°ELB

ELBé…ç½®å¦‚ä¸‹ï¼š

- å®ä¾‹ç±»å‹ï¼šç‹¬äº«å‹
- å®ä¾‹è§„æ ¼ï¼šå¼¹æ€§è§„æ ¼ï¼Œåº”ç”¨å‹+ç½‘ç»œå‹
- æ‰€å±VPCï¼šå’ŒCCEåœ¨åŒä¸€ä¸ªVPC
- å¼¹æ€§å…¬ç½‘IPå¸¦å®½ï¼š10 Mbit/s

å…·ä½“è´­ä¹°æ“ä½œå¯å‚è€ƒ [å®ç°å•ä¸ªWebåº”ç”¨çš„è´Ÿè½½å‡è¡¡](https://support.huaweicloud.com/qs-elb/zh-cn_topic_0052569751.html)

## æ­¥éª¤äºŒï¼šéƒ¨ç½²Demo

åœ¨CCEä¸­æ·»åŠ 3ä¸ªæ— çŠ¶æ€çš„å·¥ä½œè´Ÿè½½ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

### jaffle-shop-gaussdb

#### åˆ›å»ºå¹¶é…ç½®å·¥ä½œè´Ÿè½½

å‚è€ƒä¸‹å›¾é…ç½®åŸºæœ¬ä¿¡æ¯ï¼š

![](../assets/3-1.png)

å‚è€ƒä¸‹å›¾é…ç½®å®¹å™¨åŸºæœ¬ä¿¡æ¯ï¼š

![](../assets/3-2.png)

å‚è€ƒä¸‹å›¾é…ç½®å®¹å™¨ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨[GaussDBçš„ä¿¡æ¯](#gaussdb)ï¼š

![](../assets/3-3.png)

å·¥ä½œè´Ÿè½½è¿è¡ŒæˆåŠŸåå¦‚ä¸‹ï¼š

![](../assets/3-4.png)


#### è¿›å…¥å®¹å™¨æ‰§è¡Œæ•°æ®å¤„ç†

å‚è€ƒä¸‹å›¾ç™»å½•å®¹å™¨ï¼š

![](../assets/3-5.png)

![](../assets/3-6.png)

åœ¨å®¹å™¨ä¸­ï¼Œæµ‹è¯•GaussDBè¿æ¥ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š

```bash
dbt debug

```
![](../assets/3-7.png)

æµ‹è¯•æ•°æ®åœ¨seedsç›®å½•ï¼š

```bash
ls -ltr seeds/

```
![](../assets/3-8.png)

æ‰§è¡Œdbtçš„æ•°æ®å¯¼å…¥ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š

```bash
dbt seed

```
![](../assets/3-9.png)

æ­¤æ—¶ï¼Œå¯ä»¥åœ¨GaussDBä¸­æŸ¥çœ‹åˆ°æ•°æ®å·²ç»å¯¼å…¥ï¼š

```sql
ANALYZE jaffle_shop.raw_customers;
ANALYZE jaffle_shop.raw_items;
ANALYZE jaffle_shop.raw_orders;
ANALYZE jaffle_shop.raw_products;
ANALYZE jaffle_shop.raw_stores;
ANALYZE jaffle_shop.raw_supplies;

SELECT
    relname AS table_name,
    reltuples::BIGINT AS table_row_count
FROM
    pg_class c
JOIN
    pg_namespace n ON c.relnamespace = n.oid
WHERE
    n.nspname = 'jaffle_shop'
    AND c.relkind = 'r'  -- åªæŸ¥è¯¢æ™®é€šè¡¨
ORDER BY
    table_name;

```

![](../assets/3-10.png)

ç»§ç»­æ‰§è¡Œ dbt run æ¥è¿è¡Œé¡¹ç›®,å°†rawå¼€å¤´çš„è¡¨ç»è¿‡æ•°æ®æ¸…æ´—è½¬æ¢ååŠ è½½åˆ°stgå¼€å¤´çš„è¡¨ã€‚

```bash
# è¿è¡Œé¡¹ç›®
dbt run

# æˆ–è€…å¯ä»¥å¼€å¯Debugæ¨¡å¼ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ‰“å°ç”Ÿæˆçš„æ¯ä¸ª SQL æŸ¥è¯¢è¯­å¥
dbt run -d --print
```

![](../assets/3-11.png)

åœ¨GaussDBä¸­æŸ¥çœ‹æ•°æ®ï¼š

```sql
ANALYZE jaffle_shop.stg_customers;
ANALYZE jaffle_shop.stg_order_items;
ANALYZE jaffle_shop.stg_orders;
ANALYZE jaffle_shop.stg_products;
ANALYZE jaffle_shop.stg_locations;
ANALYZE jaffle_shop.stg_supplies;

SELECT
    relname AS table_name,
    reltuples::BIGINT AS table_row_count
FROM
    pg_class c
JOIN
    pg_namespace n ON c.relnamespace = n.oid
WHERE
    n.nspname = 'jaffle_shop'
    AND c.relkind = 'r'  -- åªæŸ¥è¯¢æ™®é€šè¡¨
    AND c.relname like 'stg%' -- åªæŸ¥è¯¢stgå¼€å¤´çš„è¡¨
ORDER BY
    table_name;
```

![](../assets/3-12.png)

æŠŠGaussDBçš„æ•°æ®é€šè¿‡GaussDB(DWS)çš„APIå¯¼å…¥åˆ°GaussDB(DWS)ï¼ŒæŒ‰ä¸‹é¢ä»£ç æ‰§è¡Œ

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp sample_trans_settings.yml trans_settings.yml

# æŒ‰è¯´æ˜ä¿®æ”¹å‚æ•°
vi trans_settings.yml

# æ‰§è¡Œæ•°æ®è¿ç§»
source .venv/bin/activate
python3 datatrans.py
```
![](../assets/3-13.png)

æ­¤æ—¶ï¼Œå¯ä»¥åœ¨GaussDB(DWS)ä¸­æŸ¥çœ‹åˆ°æ•°æ®ï¼š

SQLè¯­å¥åŒGaussDBä¸€æ ·ã€‚

![](../assets/3-14.png)


### jaffle-shop-dws

#### åˆ›å»ºå¹¶é…ç½®å·¥ä½œè´Ÿè½½

å‚è€ƒä¸‹å›¾é…ç½®åŸºæœ¬ä¿¡æ¯ï¼š

![](../assets/4-1.png)

å‚è€ƒä¸‹å›¾é…ç½®å®¹å™¨åŸºæœ¬ä¿¡æ¯ï¼š

![](../assets/4-2.png)

å‚è€ƒä¸‹å›¾é…ç½®å®¹å™¨ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨[GaussDB(DWS)çš„ä¿¡æ¯](#gaussdbdws)ï¼š

![](../assets/4-3.png)

å·¥ä½œè´Ÿè½½è¿è¡ŒæˆåŠŸåå¦‚ä¸‹ï¼š

![](../assets/4-4.png)


#### è¿›å…¥å®¹å™¨æ‰§è¡Œæ•°æ®å¤„ç†

å‚è€ƒä¸‹å›¾ç™»å½•å®¹å™¨ï¼š

![](../assets/4-5.png)

åœ¨å®¹å™¨ä¸­ï¼Œæµ‹è¯•GaussDB(DWS)è¿æ¥ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š

```bash
source .venv/bin/activate
dbt debug

```

![](../assets/4-6.png)


æ‰§è¡Œ `dbt run` æ¥è¿è¡Œé¡¹ç›®,å°†stgå¼€å¤´çš„è¡¨ç»è¿‡æ•°æ®æ¸…æ´—è½¬æ¢ååŠ è½½ç»“æœè¡¨ã€‚

```bash
dbt run

```

![](../assets/4-7.png)

æ­¤æ—¶ï¼Œå¯ä»¥åœ¨GaussDB(DWS)ä¸­æŸ¥çœ‹åˆ°æ•°æ®ï¼š

```sql
ANALYZE jaffle_shop.customers;
ANALYZE jaffle_shop.order_items;
ANALYZE jaffle_shop.orders;
ANALYZE jaffle_shop.products;
ANALYZE jaffle_shop.locations;
ANALYZE jaffle_shop.supplies;
ANALYZE jaffle_shop.metricflow_time_spine;

SELECT
    relname AS table_name,
    reltuples::BIGINT AS table_row_count
FROM
    pg_class c
JOIN
    pg_namespace n ON c.relnamespace = n.oid
WHERE
    n.nspname = 'jaffle_shop'
    AND c.relkind = 'r'
    AND c.relname not like 'stg%'
ORDER BY
    table_name;


```

![](../assets/4-8.png)


### resource-service-python

#### åˆ›å»ºå¹¶é…ç½®å·¥ä½œè´Ÿè½½

å‚è€ƒä¸‹å›¾é…ç½®åŸºæœ¬ä¿¡æ¯ï¼š

![](../assets/5-1.png)

å‚è€ƒä¸‹å›¾é…ç½®å®¹å™¨åŸºæœ¬ä¿¡æ¯ï¼š

![](../assets/5-2.png)

å‚è€ƒä¸‹å›¾é…ç½®å®¹å™¨ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨[GaussDB(DWS)çš„ä¿¡æ¯](#gaussdbdws)ï¼š

![](../assets/5-3.png)

å‚è€ƒä¸‹å›¾é…ç½®æœåŠ¡ï¼š

![](../assets/5-4.png)


å·¥ä½œè´Ÿè½½è¿è¡ŒæˆåŠŸåå¦‚ä¸‹ï¼š

![](../assets/5-5.png)


#### è®¿é—®APIæ¥å£

å‚è€ƒä¸‹å›¾è·å–è®¿é—®åœ°å€ï¼š

![](../assets/5-6.png)

è®¿é—®APIï¼ˆå½“ç„¶ï¼ŒDEMOæ²¡æœ‰åšæƒé™ç­‰æ§åˆ¶ï¼‰

![](../assets/5-7.png)

è·å–APIæ•°æ®

![](../assets/5-8.png)
